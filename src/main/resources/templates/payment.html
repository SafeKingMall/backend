<!DOCTYPE html>
<html lang="en">
<head>
  <!-- jQuery -->
  <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js" ></script>
  <!-- iamport.safeKingPayment.js -->
  <script src="https://cdn.iamport.kr/v1/iamport.js"></script>
  <script>
    var IMP = window.IMP;
    IMP.init("imp28306430");

    var today = new Date();
    var hours = today.getHours(); // 시
    var minutes = today.getMinutes();  // 분
    var seconds = today.getSeconds();  // 초
    var milliseconds = today.getMilliseconds();
    var makeMerchantUid = hours +  minutes + seconds + milliseconds;

    function requestPay2() {
      IMP.request_pay({
        pg : 'html5_inicis.INIpayTest',
        pay_method : 'card',
        merchant_uid: "IMP"+makeMerchantUid,
        name : '안전모 결제 테스트',
        amount : 100,
        buyer_email : 'Iamport@chai.finance',
        buyer_name : '안전왕 기술지원팀',
        buyer_tel : '010-1234-5678',
        buyer_addr : '서울특별시 강남구 삼성동',
        buyer_postcode : '123-456'
      }, function (rsp) { // callback
        if (rsp.success) {
          console.log(rsp);
        } else {
          console.log(rsp);
        }
      });
    }


    function requestPay() {

      const testData = {
        pg : 'html5_inicis.INIpayTest',
        pay_method : 'card',
        merchant_uid: "IMP"+makeMerchantUid,
        name : '안전모 결제 테스트',
        amount : 100,
        buyer_email : 'safeKing@chai.finance',
        buyer_name : '안전왕 기술지원팀',
        buyer_tel : '010-1234-5678',
        buyer_addr : '서울특별시 강남구 삼성동',
        buyer_postcode : '123-456'
      };

      IMP.request_pay({
                pg : 'html5_inicis.INIpayTest',
                pay_method : 'card',
                merchant_uid: "IMP"+makeMerchantUid,
                name : '안전모 결제 테스트',
                amount : 100,
                buyer_email : 'safeKing@chai.finance',
                buyer_name : '안전왕 기술지원팀',
                buyer_tel : '010-1234-5678',
                buyer_addr : '서울특별시 강남구 삼성동',
                buyer_postcode : '123-456'
              },
              function(rsp) {
                if (rsp.success) {
                  alert('call back!!: ' + JSON.stringify(rsp));
                  // 결제 성공 시: 결제 승인 또는 가상계좌 발급에 성공한 경우
                  // jQuery로 HTTP 요청
                  jQuery.ajax({
                    url: "api/v1/test/payment",
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    data: JSON.stringify({
                      imp_uid: rsp.imp_uid,            // 결제 고유번호
                      merchant_uid: rsp.merchant_uid,   // 주문번호
                      paid_amount: rsp.paid_amount
                    })
                  }).done(function (data) {
                    // 가맹점 서버 결제 API 성공시 로직
                    alert('Please, Check your payment result page!!' + rsp);
                  })
                } else {
                  alert("결제에 실패하였습니다. 에러 내용: " + rsp.error_msg);
                }
              });
    }
  </script>
  <meta charset="UTF-8">
  <title>Sample Payment</title>
</head>
<body>
<button onclick="requestPay()">결제하기</button> <!-- 결제하기 버튼 생성 -->
</body>
</html>